<!DOCTYPE html>
<html>
  <head><title>Yahoo Fantasy Auth</title></head>
  <body>
    <h2>Authorizing with Yahoo...</h2>
    <script>
      const params = new URLSearchParams(window.location.search);
      const code = params.get("code");

      if (code) {
        // ✅ Send code to Apps Script backend using simple POST to avoid CORS
        fetch("https://script.google.com/macros/s/AKfycbxLwnd8hV042RvZK_CBfXRUlxGDfdomXWPkChBl1f0WO5QhMz2oP-pqNEbE4bKlQks5_Q/exec", {
          method: "POST",
          body: new URLSearchParams({ code }),
          headers: {
            "Content-Type": "application/x-www-form-urlencoded"
          }
        })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            const url = `/fantasy/${data.rosterId}.html`;
            document.body.innerHTML = `<p>✅ Success! <a href="${url}">View your team</a></p>`;
          } else {
            throw new Error(data.error || "Unknown error");
          }
        })
        .catch(err => {
          document.body.innerHTML = "<p>❌ Error syncing data: " + err.message + "</p>";
        });
      } else {
        // No code → redirect to Yahoo OAuth
        const clientId = "dj0yJmk9Q3pHdTVWNlhmNERxJmQ9WVdrOVlqZzFWWEZwV0ZnbWNHbzlNQT09JnM9Y29uc3VtZXJzZWNyZXQmc3Y9MCZ4PTFl";
        const redirectUri = "https://tangomangodev.github.io/oauth.html";
        const scope = "fspt-w";

        const authUrl = `https://api.login.yahoo.com/oauth2/request_auth?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=code&scope=${scope}`;
        window.location.href = authUrl;
      }
    </script>
  </body>
</html>

