<!DOCTYPE html>
<html>
  <head><title>Yahoo Fantasy Auth</title></head>
  <body>
    <h2>Authorizing with Yahoo...</h2>
    <script>
      const params = new URLSearchParams(window.location.search);
      const code = params.get("code");

      if (code) {
        fetch("https://script.google.com/macros/s/AKfycbxLwnd8hV042RvZK_CBfXRUlxGDfdomXWPkChBl1f0WO5QhMz2oP-pqNEbE4bKlQks5_Q/exec", {
          redirect: "follow",
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ code }) // ✅ Send JSON payload
        })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            document.body.innerHTML = `<p>✅ Success! Your roster ID is: ${data.rosterId}</p>`;
          } else {
            document.body.innerHTML = `<p>❌ Error: ${data.error || 'Unknown error'}</p>`;
          }
        })
        .catch(err => {
          document.body.innerHTML = `<p>❌ Network error: ${err.message}</p>`;
        });
      } else {
        // Redirect to Yahoo OAuth if no code
        const clientId = "dj0yJmk9Q3pHdTVWNlhmNERxJmQ9WVdrOVlqZzFWWEZwV0ZnbWNHbzlNQT09JnM9Y29uc3VtZXJzZWNyZXQmc3Y9MCZ4PTFl";
        const redirectUri = "https://mangodeploy.com/auth/yahoo/yauth.html";
        const scope = "fspt-w";
        const authUrl = `https://api.login.yahoo.com/oauth2/request_auth?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=code&scope=${scope}`;
        window.location.href = authUrl;
      }
    </script>
  </body>
</html>


