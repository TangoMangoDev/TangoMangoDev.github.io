<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mango Authentication</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- allow One-Tap popups + restrict connect-src to just what we need -->
  <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin-allow-popups">
  <meta http-equiv="Content-Security-Policy"
        content="connect-src 'self' https://accounts.google.com https://mangodeploy.com https://stateezer.com;">

  <!-- Load the One-Tap library -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <style>
    /* Reset & base */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body, html {
      height: 100%;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      background-color: #f0f2f5;
      color: #333;
    }

    /* Centered container */
    .container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 1rem;
      height: 100%;
      text-align: center;
    }

    /* Placeholder for logo */
    .logo-placeholder {
      width: 100px;
      height: 100px;
      margin-bottom: 1.5rem;
      background-color: #ddd;
      border-radius: 50%;
    }

    /* App name */
    .app-name {
      font-size: 2.25rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    /* Tagline */
    .tagline {
      font-size: 1.125rem;
      color: #555;
      margin-bottom: 2rem;
    }

    /* Scale Google button up a bit */
    .g_id_signin > div {
      transform: scale(1.2);
      transform-origin: center;
    }

    /* Responsive tweaks */
    @media (max-width: 480px) {
      .logo-placeholder { width: 80px; height: 80px; margin-bottom: 1rem; }
      .app-name { font-size: 1.75rem; }
      .tagline { font-size: 1rem; margin-bottom: 1.5rem; }
      .g_id_signin > div { transform: scale(1.1); }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- future logo goes here -->
    <div class="logo-placeholder"></div>

    <h1 class="app-name">Stateezer</h1>
    <p class="tagline">Sign in with Google or Yahoo. This is the way.</p>

    <!-- One-Tap UI placeholders (logic unchanged) -->
    <div id="g_id_onload"
         data-client_id="2834657814-ji7cvo8o9h3beddaui7i43rpjoe20ftm.apps.googleusercontent.com"
         data-auto_prompt="false"
         data-cancel_on_tap_outside="false"
         data-callback="onOneTapResponse">
    </div>

    <div class="g_id_signin" data-type="standard"></div>
    
    <!-- Yahoo Authentication Button -->
    <div style="margin-top: 1rem;">
      <button onclick="window.location.href='/auth/yauth'" 
              style="padding: 0.75rem 1.5rem; font-size: 1rem; border: none; border-radius: 4px; background: #6001d2; color: #fff; cursor: pointer;">
        Sign in with Yahoo
      </button>
    </div>
  </div>

  <script>
    async function onOneTapResponse(response) {
      if (!response.credential) {
        console.error('No credential returned');
        return;
      }
      const authToken = response.credential;

      try {
        const apiUrl = 'https://mangodeploy.com/auth/gauth';
        const res = await fetch(apiUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + authToken
          },
          credentials: 'include',
          body: JSON.stringify({})
        });

        if (!res.ok) {
          throw new Error(`Auth failed (${res.status}): ${await res.text()}`);
        }

        const userStatusData = await res.json();

    function initializeGSI() {
      google.accounts.id.prompt();
    }
    window.addEventListener('load', initializeGSI);
  </script>
</body>
</html>
